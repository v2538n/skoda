function onScroll(){var e=$(document).scrollTop();$(menu_selector+" a").each(function(){var t=$(this).attr("href"),a=$(t);a.position().top-70<=e&&a.position().top-70+a.outerHeight()>e?($(menu_selector+" a.active").removeClass("active"),$(this).addClass("active")):$(this).removeClass("active")})}function closeMenu(){$("div.burger").removeClass("open"),$(".nav").removeClass("open"),$("div.x").removeClass("rotate45").addClass("rotate30"),$("div.z").removeClass("rotate135").addClass("rotate150"),setTimeout(function(){$("div.x").removeClass("rotate30"),$("div.z").removeClass("rotate150")},50),setTimeout(function(){$("div.y").show(),$("div.x, div.y, div.z").removeClass("collapse")},70)}function screenSize(){var e=window,t=document,a=t.documentElement,o=t.getElementsByTagName("body")[0];return{x:e.innerWidth||a.clientWidth||o.clientWidth,y:e.innerHeight||a.clientHeight||o.clientHeight}}function phoneLocal(e){return e.replace(/(\d{1})(\d{3})(\d{3})(\d{2})(\d{2})/,"$1 ($2) $3-$4-$5")}var menu_selector="#scrollfix .nav";Vue.component("my-phone",{template:'<span class="phone call_phone_1"><a href="tel:'+sets.phone+'" title="Позвонить по '+phoneLocal(sets.phone)+'">'+phoneLocal(sets.phone)+"</a></span>"}),Vue.directive("input-mask",{bind:function(e,t,a){$(e).inputmask()}}),new Vue({el:"#ya-metrika",data:{ya_metrika:sets.ya_metrika},template:'<noscript v-if="ya_metrika != 0"><div><img src="https://mc.yandex.ru/watch/'+sets.ya_metrika+'" style="position:absolute; left:-9999px;" alt="" /></div></noscript>'}),new Vue({el:"#app",data:{data:sets,phoneSended:"not",inputtedPhone:"",inputtedName:"",inputtedEmail:"",placeholderPhone:"",placeholderName:"",placeholderEmail:"",popupIsOpen:!1,workingHours:!1,popupAgreement:!1,popupRegistr:!1,popupCall:!1,pageType:"desktop",carType:"all",carPicked:0,carPickedName:"picanto"},methods:{changeModel:function(e,t){if(e!==this.carPickedName){this.carPickedName=e,this.carPicked=t,$(".tabs .car_tab").removeClass("active"),$(".tabs .car_tab:eq("+t+")").addClass("active");for(var a=this.data.cars[t].models.length-1;a>=0;a--)this.data.cars[t].models[a],$(".card:eq("+a+") p.colorName span.no-wrap").text(this.colorName(this.data.cars[t].models[a].colors[0]))}},colorName:function(e){for(var t=0;t<this.data.colors.length;t++)if(this.data.colors[t].id===e)return this.data.colors[t].name},colorCode:function(e){for(var t=0;t<this.data.colors.length;t++)if(this.data.colors[t].id===e)return this.data.colors[t].code},changeColor:function(e,t,a,o,i,s){$(".card:eq("+t+") img.imageCar").attr("src","img/cars/colors/"+this.data.cars[s].id+"/"+this.data.cars[s].models[t].colors[i]+this.data.cars[s].models[t].gt+".jpg"),$(".card:eq("+t+") p.colorName span.no-wrap").text(a),console.log(e,t,a,o,i,s)},slideTo:function(e){$("#slider").flickity("selectCell","#"+e,!1,!0),document.activeElement.blur(),closeMenu()},scrollTo:function(e){var t=this.getCoords(document.getElementById(e)).top;$("#header").height();$("body,html").animate({scrollTop:t-70},300),document.activeElement.blur(),this.closeMenu()},getCoords:function(e){for(var t=0,a=0;e;)t+=parseInt(e.offsetTop),a+=parseInt(e.offsetLeft),e=e.offsetParent;return{top:t,left:a}},minimum:function(e,t){var a=99999999;return $.each(e,function(e,o){$.each(o,function(e,o){e==t&&o<a&&(a=o)})}),a},maximum:function(e,t){var a=Number(e[0][t]);return $.each(e,function(e,o){$.each(o,function(e,o){e==t&&Number(o)>a&&(a=Number(o))})}),a},localeNumber:function(e){return output=Number(e),output.toLocaleString()},openPopup:function(e){this.ios(),"agreement"===e&&(this.popupAgreement=!0),"registr"===e&&(this.popupRegistr=!0),"Call"===e&&(this.popupCall=!0),this.popupIsOpen=!0,$("#popup").css("overflow","hidden"),"agreement"!==e&&(setTimeout(function(){$('input[type="tel"]').focus()},500),document.body.style.overflow="hidden",document.ontouchmove=function(e){e.preventDefault()},0!==sets.ya_metrika&&"not"===this.phoneSended&&void 0!==window["yaCounter"+this.data.ya_metrika]&&window["yaCounter"+sets.ya_metrika].reachGoal("lead"));var t=document.getElementById("popup"),a=this;t.addEventListener("mouseup",function(e){e.target===t&&a.closePopup()})},closePopup:function(){this.popupIsOpen=!1,this.popupAgreement=!1,this.popupCall=!1,this.popupRegistr=!1;document.getElementById("popup");document.body.style.overflow="inherit",document.ontouchmove=function(e){return!0};var e=document.getElementsByTagName("html")[0];e.classList.remove("ios"),(e=document.getElementsByTagName("body")[0]).classList.remove("ios"),this.phoneSended="not"},ios:function(){if(1==(/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream)){var e=document.getElementsByTagName("html")[0];e.className+=" ios",(e=document.getElementsByTagName("body")[0]).className+=" ios"}},toggleMenu:function(){$("div.burger").hasClass("open")?this.closeMenu():this.openMenu()},openMenu:function(){$("div.burger").addClass("open"),$(".nav").addClass("open"),$("div.x, div.y, div.z").addClass("collapse"),setTimeout(function(){$("div.y").hide(),$("div.x").addClass("rotate30"),$("div.z").addClass("rotate150")},70),setTimeout(function(){$("div.x").addClass("rotate45"),$("div.z").addClass("rotate135")},120)},closeMenu:function(){$("div.burger").removeClass("open"),$(".nav").removeClass("open"),$("div.x").removeClass("rotate45").addClass("rotate30"),$("div.z").removeClass("rotate135").addClass("rotate150"),setTimeout(function(){$("div.x").removeClass("rotate30"),$("div.z").removeClass("rotate150")},50),setTimeout(function(){$("div.y").show(),$("div.x, div.y, div.z").removeClass("collapse")},70)},sendForm:function(){$(".circle-loader").removeClass("checking");var e=this.checkForm(this.inputtedPhone);if(0!=e.check){this.placeholderPhone="+7 (___) ___-__-__",this.phoneSended="sending",0!=this.data.ya_metrika&&void 0!==window["yaCounter"+this.data.ya_metrika]&&window["yaCounter"+this.data.ya_metrika].reachGoal("final_lead");e.number;var t=$("#select-car").val(),a=new FormData;""!=t&&a.append("carSelect",t),a.append("phone",e.number),a.append("name",this.inputtedName),void 0!=this.inputtedEmail&&""!=this.inputtedEmail&&(a.append("email",this.inputtedEmail),console.log(this.inputtedEmail)),a.append("email_title",this.data.email_title),a.append("email_addresses",this.data.email_addresses),a.append("call_value",window.call_value);var o=this;$.ajax({type:"POST",url:"send.php",data:a,processData:!1,contentType:!1,dataType:"json",complete:function(e){document.activeElement.blur(),setTimeout(function(){o.popupIsOpen||o.openPopup("Call"),o.phoneSended="sended"},3e3)}})}else this.placeholderPhone="",this.inputtedPhone="",$('input[type="tel"]').each(function(){$(this).parent().find("p.placholder_text").addClass("red")});return!1},checkForm:function(e){var t=!0;console.log(e),"+"!=e.substring(0,1)&&(e="+7"+e),console.log(e);var a=phoneNumberParser(e);if(console.log(a.parsingResult),"error"==a.parsingResult||0==a.isPossibleNumber||0==a.isValidNumber||"invalid"==a.eFormat){t=!1;var o=new FormData;o.append("inputtedData",e),o.append("email_title",sets.email_title),o.append("parsingResult",a.parsingResult),o.append("errorDescription",a.errorDescription),o.append("isPossibleNumber",a.isPossibleNumber),o.append("notPossibleReason",a.notPossibleReason),o.append("isValidNumber",a.isValidNumber),o.append("eFormat",a.eFormat),"error"!=a.parsingResult&&$.ajax({type:"POST",url:"send_wrong_number.php",data:o,processData:!1,contentType:!1,dataType:"json",complete:function(){}})}else $("input[name='phone']").removeClass("red");return 1!=t?{check:!1}:{check:!0,number:a.eFormat}}},computed:{maxBenefit:function(){for(var e=[],t=0;t<this.data.cars.length;t++)e.push(this.maximum(this.data.cars[t].models,"benefit"));var a=e[0];for(t=1;t<e.length;++t)e[t]>a&&(a=e[t]);return a},minPrice:function(){for(var e=[],t=0;t<this.data.cars.length;t++)e.push(this.minimum(this.data.cars[t].models,"price"));var a=e[0];for(t=1;t<e.length;++t)e[t]<a&&(a=e[t]);return a},year:function(){return(new Date).getFullYear()},month:function(){var e=new Date;return sets.months[e.getMonth()]},month_2:function(){var e=new Date;return sets.months_2[e.getMonth()]},lastday:function(){var e=new Date;return new Date(e.getFullYear(),e.getMonth()+1,0).getDate()},screenSize:function(){var e=window,t=document,a=t.documentElement,o=t.getElementsByTagName("body")[0];return{x:e.innerWidth||a.clientWidth||o.clientWidth,y:e.innerHeight||a.clientHeight||o.clientHeight}}},created:function(){var e=(new Date).getHours();e>=this.data.time_work_from&&e<=this.data.time_work_to&&(this.workingHours=!0);window.location.search.replace("?","");window.params=window.location.search.replace("?","").split("&").reduce(function(e,t){var a=t.split("=");return e[decodeURIComponent(a[0])]=decodeURIComponent(a[1]),e},{});var t=this;switch(window.params.type){case"desktop":t.pageType="desktop";break;case"night":t.pageType="night";break;case"mobile":t.pageType="mobile"}},mounted:function(){if("desktop"===this.pageType){var e=this;$(".tabs .car_tab:first-child").addClass("active"),$(document).scroll(function(){var t=e.getCoords(document.getElementById("cars")).top;$(window).scrollTop()>=t?$("#scrollfix").addClass("active"):$("#scrollfix").removeClass("active")});t={lat:59.833569,lng:30.426718};if(screenSize().x<760)var t={lat:59.833569,lng:30.426718};!function(){var e={lat:59.828569,lng:30.426718},a=new google.maps.Map(document.getElementById("map"),{zoom:15,center:t,scrollwheel:!1,disableDefaultUI:!0});new google.maps.Marker({position:e,map:a,icon:{url:"./img/icons/pin.svg",scaledSize:new google.maps.Size(30,48)}});$.getJSON("./libs/map-style_colored.json",function(e){a.setOptions({styles:e})})}(),wow=new WOW({boxClass:"wow",animateClass:"animated",offset:50,mobile:!1,live:!0}),wow.init();$(".slider_credit").flickity({pageDots:!1,draggable:!0,content:!0,resize:!0,percentPosition:!1,wrapAround:!0,on:{change:function(e){},ready:function(){}}}),$("#cars .tabs").flickity({pageDots:!1,draggable:!0,content:!0,resize:!0,percentPosition:!1,wrapAround:!0,on:{change:function(e){$("#cars .tabs").flickity("reloadCells"),$("#cars .tabs").flickity("resize"),setTimeout(function(){$("#desktop #cars .tabs .car_tab.is-selected").trigger("click")},100)},ready:function(){$("#cars .tabs").flickity("reloadCells"),$("#cars .tabs").flickity("resize")}}});setTimeout(function(){$("#cars .tabs").flickity("reloadCells"),$("#cars .tabs").flickity("resize"),$(".slider_credit").flickity("reloadCells"),$(".slider_credit").flickity("resize")},100),$(".car_tab").click(function(){var e=$(this).index();$("#desktop #cars .tabs").flickity("selectCell",e)});$(".slider_main").flickity({pageDots:!0,draggable:!0,content:!0,resize:!0,percentPosition:!1,wrapAround:!0});if($(window).resize(function(){$("#cars .tabs").flickity("reloadCells"),$("#cars .tabs").flickity("resize")}),void 0!=params.car)for(o=0;o<sets.cars.length;o++)if(params.car==sets.cars[o].id){screenSize().x>996?$('div[data-model="'+params.car+'"]').trigger("click"):$("#desktop #cars .tabs").flickity("selectCell",'div[data-model="'+params.car+'"]');var a=this.getCoords(document.getElementById("cars")).top;$("body,html").animate({scrollTop:a-70},300)}}else if("mobile"===this.pageType){$("#slider").flickity({pageDots:!1,draggable:!0,content:!0,contain:!0,resize:!0,percentPosition:!1,wrapAround:!0});if(void 0!=params.model)for(var o=0;o<sets.cars.length;o++)if(params.model==sets.cars[o].id){$("#slider").flickity("selectCell","#"+params.model,!1,!0);break}}$(".slideToggle").click(function(){$(".toggleBlock").slideToggle()}),$('form input[type="tel"]').keyup(function(){var e=this.value;if($(".circle-loader").addClass("checking"),-1!=e.indexOf("_"))$(".checkmark").removeClass("checked"),$(".circle-loader").removeClass("load-complete"),$(".circle-loader").removeClass("wrong"),$("form .btn").removeClass("right");else{var t=phoneNumberParser(e);"error"==t.parsingResult||0==t.isPossibleNumber||0==t.isValidNumber||"invalid"==t.eFormat?($(".circle-loader").addClass("load-complete"),$(".checkmark").removeClass("checked"),$(".circle-loader").addClass("wrong"),$("form .btn").removeClass("right"),$(".circle-loader.wrong").click(function(){$(this).parent().find("input").val(""),document.activeElement.blur(),$(this).parent().find("input").focus()})):($(".circle-loader").addClass("load-complete"),$(".checkmark").addClass("checked"),$(".circle-loader").removeClass("wrong"),$("form .btn").addClass("right"),$("input[name='phone']").removeClass("redput"))}}),$("form .phone").focusout(function(){$(".circle-loader").removeClass("checking")}),$("form input").on("focusout",function(){""===$(this).val()&&$(this).parent(".input-block").removeClass("active")}),$("form input").on("focus",function(){$(this).parent(".input-block").hasClass("active")||$(this).parent(".input-block").addClass("active")})}});